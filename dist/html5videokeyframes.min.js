!function(e,t,o){"use strict";function n(e){return a=this,e.wrapper?e.props?(this._videoElement=t.getElementById(s(e.wrapper,e.props)),this._buffered=!1,this._interval=null,this._keyframes=null,e.keyframes?void a._loadData(e.keyframes).then(function(e){a._parseData(e)},function(e){console.log("Error loading data",e)}):void console.log("No keyframe xml defined")):void console.log("No video properties defined"):void console.log("No wrapper id defined")}var r={get:function(){return a},init:function(e){return a||new n(e)},VERSION:"0.0.01"};n.prototype.goToAndPlay=function(e){a._keyframeState().then(function(){var t,n,r,s;return e.constructor===Object?(t=e.name,s=e.onBegin||o,r=e.onComplete||o):e.constructor===String&&(t=e),(n=p(a,t))?(n.onComplete=r?r:n.complete,n.onBegin=s?s:n.begin,a._seekTo(n.start),a._startInterval(n),void a._play()):void console.log("No keyframe data found")},function(){setTimeout(function(){a.goToAndPlay(e)},50)})},n.prototype.goToAndStop=function(e){a._keyframeState().then(function(){var e,t=p(a,e);return t?void a._seekTo(t.start):void console.log("No keyframe data found")},function(){setTimeout(function(){a.goToAndStop(e)},50)})},n.prototype.stop=function(){a._stop()},n.prototype.play=function(){a._play()},n.prototype.pause=function(){a._pause()},n.prototype.destroy=function(){clearInterval(a._interval),a=null};var a;n.prototype._loadData=function(e){return new Promise(function(t,o){var n=new XMLHttpRequest;n.open("GET",e,!0),n.setRequestHeader("Content-type","text/xml"),n.onreadystatechange=function(){switch(this.readyState){case 0:break;case 1:break;case 2:break;case 3:break;case 4:200==n.status?t(n.responseText):o(n.statusText)}},n.onerror=function(){o("Network Error")},n.send()})},n.prototype._parseData=function(e){a._keyframes=xml2json.parser(e).keyframes},n.prototype._keyframeState=function(){return new Promise(function(e,t){a._keyframes?e():t()})},n.prototype._bufferState=function(){return new Promise(function(e,t){a.buffer?a.buffer&&a.buffered?e():t():e()})},n.prototype._startInterval=function(e){e.onBegin&&i(a,e.onBegin,e),a._stopInterval(),a._interval=setInterval(function(){a._doubleCheck(e)},10)},n.prototype._stopInterval=function(){try{clearInterval(a._interval)}catch(e){}},n.prototype._monitorInterval=function(e){if(Math.round(a._videoElement.currentTime)===Math.round(e.end)){var t=1%(this._videoElement.currentTime/e.end);(0===t||1===t)&&(a._stopInterval(),a._pause(),e.onComplete&&i(a,e.onComplete,e))}},n.prototype._doubleCheck=function(e){Math.round(a._videoElement.currentTime)>Math.round(e.end)+1&&(a._stopInterval(),a._pause(),e.onComplete&&i(a,e.onComplete,e))},n.prototype._seekTo=function(e){try{a._videoElement.currentTime=e}catch(t){}},n.prototype._play=function(){a._videoElement.play()},n.prototype._stop=function(){a._videoElement.currentTime=0,a._videoElement.pause()},n.prototype._pause=function(){a._videoElement.pause()},n.prototype._loop=function(e){a._seekTo(e.start),a._startInterval(e),a._play()};var s=function(e,o){var n=t.getElementById(e),r=o.id||"video-"+f(5),a=o.forceReload?"?v="+f(20):"",s="<video ";return s+='width="',s+=o.width||320,s+='" height="',s+=o.height||240,s+='" id="'+r+'" ',o.attrs.muted===!0&&(s+="muted "),o.attrs.controls===!0&&(s+="controls "),o.attrs.autoplay===!0&&(s+="autoplay "),o.attrs.poster&&(s+='poster="'+o.attrs.poster+'" '),o.attrs.title&&(s+='title="'+o.attrs.title+'" '),s+='preload="auto">',o.srcs.mp4&&(s+='<source src="'+o.srcs.mp4+a+'" type="video/mp4">'),o.srcs.ogg&&(s+='<source src="'+o.srcs.ogg+a+'" type="video/ogg">'),o.srcs.webm&&(s+='<source src="'+o.srcs.ogg+a+'" type="video/webm">'),s+='Your browser does not support HTML5 video...<a href="http://browsehappy.com/" target="_blank" title="Browse Happy">best upgrade</a>',s+="</video>",n.innerHTML=s,r},i=function(e,t,o){if(t.constructor===String)c(e,t,o);else if(t.constructor===Object){if(!t.func)return void console.log("Malformed params passed");if(t.func.constructor===Array)for(var n=0;n<t.func.length;n++)t.func[n].constructor===String?c(e,t.func[n],o):t.func[n].constructor===Object&&u(t.func[n]);else t.func.constructor===Object&&u(t.func)}},c=function(e,t,o){switch(t){case"stop":e._stop();break;case"loop":e._loop(o);break;case"pause":e._pause();break;default:e._pause()}},u=function(t){var o=t.scope?t.scope:a;o.constructor===String&&"window"===o&&(o=e),o.constructor===Object&&(o=a);try{o[t.name](t.params)}catch(n){console.log("function "+t.name+" with scope "+o+" is undefined!")}},p=function(e,t){for(var o=e._keyframes.keyframe,n=0;n<o.length;n++)if(o[n].name==t)return o[n];return null},f=function(e){for(var t="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;e>n;n++)t+=o.charAt(Math.floor(Math.random()*o.length));return t},l=function(){try{new Promise}catch(e){ES6Promise.polyfill()}};l(),"function"==typeof define&&define.amd?define([],function(){return r}):"undefined"!=typeof module&&module.exports?module.exports=r:e.vkf=r}(window,document);