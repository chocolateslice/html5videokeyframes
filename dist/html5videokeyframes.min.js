!function(window,document,undefined){"use strict";function HTML5VideoKeyframes(e){return _instance=this,this._videoElement=null,this._buffer=null,this._interval=null,this._keyframes=null,e.id?(_instance._videoElement=document.getElementById(e.id),e.src?(_instance._buffer=e.buffer||!0,void _instance._loadData(e.src).then(function(e){_instance._parseData(e)},function(e){console.log("Error loading data",e)})):void console.log("No keyframe src defined")):void console.log("No video id defined")}var vkf={get:function(){return _instance},init:function(e){return _instance||new HTML5VideoKeyframes(e)},VERSION:"0.0.01"};HTML5VideoKeyframes.prototype.gotoAndPlay=function(e){_instance._keyframeState().then(function(){var n,t,o;e.constructor===Object?(n=e.name,o=e.onBegin||undefined,t=e.onComplete||undefined):e.constructor===String&&(n=e);var r=_keyframeByName(_instance,n);r.onComplete=t?t:r.complete,r.onBegin=o?o:r.begin,_instance._seekTo(r.start),_instance._startInterval(r),_instance._play()},function(){setTimeout(function(){_instance.gotoAndPlay(e)},50)})},HTML5VideoKeyframes.prototype.stop=function(){_instance._stop()},HTML5VideoKeyframes.prototype.play=function(){_instance._play()},HTML5VideoKeyframes.prototype.pause=function(){_instance._pause()},HTML5VideoKeyframes.prototype.destroy=function(){clearInterval(_instance._interval),_instance=null};var _instance;HTML5VideoKeyframes.prototype._keyframeState=function(){return new Promise(function(e,n){_instance._keyframes?e():n()})},HTML5VideoKeyframes.prototype._startInterval=function(e){e.onBegin&&_processKeyframeEvent(_instance,e,"onBegin"),_instance._stopInterval(),_instance._interval=setInterval(function(){_instance._monitorInterval(e)},10)},HTML5VideoKeyframes.prototype._stopInterval=function(){try{clearInterval(_instance._interval)}catch(e){}},HTML5VideoKeyframes.prototype._monitorInterval=function(e){if(Math.round(_instance._videoElement.currentTime)===Math.round(e.end)){var n=1%(this._videoElement.currentTime/e.end);(0===n||1===n)&&(_instance._stopInterval(),_instance._pause(),e.onComplete&&_onComplete(_instance,e.onComplete,e))}},HTML5VideoKeyframes.prototype._seekTo=function(e){_instance._videoElement.currentTime=e},HTML5VideoKeyframes.prototype._play=function(){_instance._videoElement.play()},HTML5VideoKeyframes.prototype._stop=function(){_instance._videoElement.currentTime=0,_instance._videoElement.pause()},HTML5VideoKeyframes.prototype._pause=function(){_instance._videoElement.pause()},HTML5VideoKeyframes.prototype._loop=function(e){_instance._seekTo(e.start),_instance._startInterval(e),_instance._play()},HTML5VideoKeyframes.prototype._loadData=function(e){return new Promise(function(n,t){var o=new XMLHttpRequest;o.open("GET",e,!0),o.setRequestHeader("Content-type","text/xml"),o.onreadystatechange=function(){switch(this.readyState){case 0:break;case 1:break;case 2:break;case 3:break;case 4:200==o.status?n(o.responseText):t(o.statusText)}},o.onerror=function(){t("Network Error")},o.send()})},HTML5VideoKeyframes.prototype._parseData=function(e){_instance._keyframes=xml2json.parser(e).keyframes};var _onComplete=function(e,n,t){if(n.constructor===String)_processEventsFromString(e,n,t);else if(n.constructor===Object){if(!n.func)return void console.log("Malformed params passed");if(n.func.constructor===Array)for(var o=0;o<n.func.length;o++)n.func[o].constructor===String?_processEventsFromString(e,n.func[o],t):n.func[o].constructor===Object&&_processKeyframeFunction(n.func[o]);else n.func.constructor===Object&&_processKeyframeFunction(n.func)}},_processEventsFromString=function(e,n,t){switch(n){case"stop":e._stop();break;case"loop":e._loop(t);break;case"pause":e._pause();break;default:e._pause()}},_processKeyframeFunction=function(func){var scope=func.scope?func.scope:_instance;scope.constructor===String&&(scope=eval(scope)),scope.constructor===Object&&(scope=_instance);try{scope[func.name](func.params)}catch(e){console.log("function "+func.name+" with scope "+scope+" is undefined!")}},_keyframeByName=function(e,n){for(var t=e._keyframes.keyframe,o=0;o<t.length;o++)if(t[o].name==n)return t[o];return null};"function"==typeof define&&define.amd?define([],function(){return vkf}):"undefined"!=typeof module&&module.exports?module.exports=vkf:window.vkf=vkf}(window,document);